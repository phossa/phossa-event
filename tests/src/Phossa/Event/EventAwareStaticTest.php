<?php
namespace Phossa\Event;

/**
 * Generated by PHPUnit_SkeletonGenerator on 2015-10-21 at 08:50:05.
 */
class EventAwareStaticTest extends \PHPUnit_Framework_TestCase
{


    /**
     * Sets up the fixture, for example, opens a network connection.
     * This method is called before a test is executed.
     */
    protected function setUp()
    {
        require_once __DIR__.'/EventAwareStatic.php';
    }

    /**
     * Tears down the fixture, for example, closes a network connection.
     * This method is called after a test is executed.
     */
    protected function tearDown()
    {
    }

    /**
     * set event manager for static class
     *
     * @covers Phossa\Event\EventAware::setEventManager
     */
    public function testSetEventManager1()
    {
        EventAwareStatic::setEventManager(
            new EventManager()
        );
    }

    /**
     * set event manager and event factory for static class
     *
     * @covers Phossa\Event\EventAware::setEventManager
     */
    public function testSetEventManager2()
    {
        EventAwareStatic::setEventManager(
            new EventManager(),
            function($e, $c, $p) {
                return new Event($e, $c, $p);
            }
        );
    }

    /**
     * @covers Phossa\Event\EventAware::triggerEvent
     */
    public function testTriggerEvent()
    {
        $manager = new EventManager();
        require_once __DIR__.'/Listener.php';
        require_once __DIR__.'/ListenerStatic.php';
        $manager->attachListener(new Listener());
        $manager->attachListener('Phossa\\Event\\ListenerStatic');

        EventAwareStatic::setEventManager($manager);

        $e1 = EventAwareStatic::triggerEvent('evtTest4');

        // has 'testY'
        $this->assertArrayHasKey('testY', $e1->getProperties());
        // stopped after 'testY'
        $this->assertArrayNotHasKey('testZ', $e1->getProperties());

        // both object/static listener has 'evtTest2'
        $e2 = EventAwareStatic::triggerEvent('evtTest2', ['x' => 'xx']);
        $this->assertArrayHasKey('testD', $e2->getProperties());
        $this->assertArrayHasKey('s_testDD', $e2->getProperties());
        $this->assertArrayHasKey('x', $e2->getProperties());
    }
}
